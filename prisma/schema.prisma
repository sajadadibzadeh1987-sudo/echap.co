generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String    @id @default(cuid())
  phone           String    @unique
  password        String?
  role            UserRole  @default(USER)
  hasSelectedRole Boolean   @default(false)
  firstName       String?
  lastName        String?
  email           String?   @unique
  slug            String?   @unique
  image           String?
  bio             String?
  otp             String?
  otpExpiry       DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // â­ Ø³ÛŒØ³ØªÙ… Ø³Ú©Ù‡â€ŒÙ‡Ø§
  coins       Int       @default(0)
  lastCheckIn DateTime?

  jobAds           JobAd[]
  businessProfile  BusinessProfile?
  printShopProfile PrintShopProfile?

  // ØµÙ†Ø¯ÙˆÙ‚ Ù¾ÛŒØ§Ù… / Ú†Øª
  chatMessages ChatMessage[]

  // (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡) Ù†ÙˆØªÛŒÙÛŒÚ©Ø´Ù†â€ŒÙ‡Ø§
  notifications Notification[]
}

model JobAd {
  id          String   @id @default(cuid())
  title       String
  description String
  category    String
  phone       String
  createdAt   DateTime @default(now())
  isFeatured  Boolean  @default(false)

  /// Ù…Ø³ÛŒØ± Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ (Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ú©Ø¯Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ)
  images String[]

  /// âœ… Ø³Ø§Ø®ØªØ§Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù ØªØµÙˆÛŒØ±
  /// Ù‡Ø± Ø¢ÛŒØªÙ… Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø´Ø¨ÛŒÙ‡ Ø§ÛŒÙ† Ø¨Ø§Ø´Ø¯:
  /// { "full": "/uploads/abc.jpg", "thumb": "/uploads/thumbs/abc.jpg" }
  imagesJson Json[] @default([])

  status JobAdStatus @default(PENDING)

  group        String?
  categorySlug String?

  userId String?
  user   User?   @relation(fields: [userId], references: [id])

  moderatedById  String?
  moderatedAt    DateTime?
  moderationNote String?

  isDeleted    Boolean   @default(false)
  deletedById  String?
  deletedAt    DateTime?
  deleteReason String?

  // Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ú¯Ù‡ÛŒ (Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ¨Ø§Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡â€ŒÛŒ Ø§ÛŒÙ† Ø¢Ú¯Ù‡ÛŒ)
  chatMessages ChatMessage[]

  // Ù†ÙˆØªÛŒÙÛŒÚ©Ø´Ù†â€ŒÙ‡Ø§ (Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒÙ…)
  notifications Notification[]
}

model BusinessProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  slug          String   @unique
  displayName   String
  description   String?
  services      String[]
  phone         String?
  address       String?
  locationLat   Float?
  locationLng   Float?
  logoUrl       String?
  galleryImages String[]
  openingHours  String?
  website       String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model PrintShopProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  name          String
  slug          String   @unique
  description   String?
  phone         String?
  address       String?
  locationLat   Float?
  locationLng   Float?
  logoUrl       String?
  galleryImages String[]
  clients       String[]
  capabilities  String[] @default([])
  openingHours  String?
  website       String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model OTP {
  id        Int      @id @default(autoincrement())
  phone     String   @unique
  code      String
  createdAt DateTime @default(now())
}

enum JobAdStatus {
  PENDING
  PUBLISHED
  REJECTED
}

enum UserRole {
  USER
  FREELANCER
  SUPPLIER
  PRINTSHOP
  SUPER_ADMIN
}

// Ù†ÙˆØ¹ ÙØ±Ø³ØªÙ†Ø¯Ù‡â€ŒÛŒ Ù¾ÛŒØ§Ù… Ø¯Ø± Ú†Øª
enum ChatSender {
  USER // Ø®ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
  SYSTEM // Ø±ÙˆØ¨Ø§Øª Ø§ÛŒÚ†Ø§Ù¾
  ADMIN // Ù…Ø¯ÛŒØ± / Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
}

// ğŸ“¥ Ù…Ø¯Ù„ Ú†Øª / ØµÙ†Ø¯ÙˆÙ‚ Ù¾ÛŒØ§Ù…
model ChatMessage {
  id        String     @id @default(cuid())
  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  sender    ChatSender
  text      String
  jobAdId   String?
  jobAd     JobAd?     @relation(fields: [jobAdId], references: [id], onDelete: SetNull)
  isRead    Boolean    @default(false)
  createdAt DateTime   @default(now())
  readAt    DateTime?
}

// (Ø§Ø®ØªÛŒØ§Ø±ÛŒ â€“ Ø§Ú¯Ø± Ù†Ø®ÙˆØ§Ø³ØªÛŒ Ø¨Ø¹Ø¯Ø§Ù‹ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… Ø­Ø°Ù Ú©Ù†ÛŒÙ…)
enum NotificationType {
  AD_CREATED
  AD_PENDING
  AD_APPROVED
  AD_REJECTED
  AD_DELETED
}

model Notification {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  type    NotificationType
  title   String
  message String

  jobAdId String?
  jobAd   JobAd?  @relation(fields: [jobAdId], references: [id], onDelete: Cascade)

  sender String @default("Ø§ÛŒÚ†Ø§Ù¾")

  isRead    Boolean   @default(false)
  createdAt DateTime  @default(now())
  readAt    DateTime?
}
